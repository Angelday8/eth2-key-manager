package account_test

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/bloxapp/eth-key-manager/cli/cmd"
	"github.com/bloxapp/eth-key-manager/cli/util/printer"
)

func TestAccountDelete(t *testing.T) {
	t.Run("Successfully delete last indexed account", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"delete",
			"--storage=7b226163636f756e7473223a2237623232363136353632333736343632363233303264363336313339333032643334333833343339326433383632333133363264333233303331333933333337333836343331363336333339323233613762323236323631373336353431363336333666373536653734353036313734363832323361323232663330323232633232363936343232336132323631363536323337363436323632333032643633363133393330326433343338333433393264333836323331333632643332333033313339333333373338363433313633363333393232326332323665363136643635323233613232363136333633366637353665373432643330323232633232373636313663363936343631373436393666366534623635373932323361376232323639363432323361323236333331333533313332333136343635326436353332333933303264333433313632333432643632333233333330326433333332363236333635363233363631333936353336333632323263323237303631373436383232336132323664326633313332333333383331326633333336333033303266333032663330326633303232326332323730373236393736346236353739323233613232333233333636363433343336333436333331333233323634333736363631333836333339363333383635333433363634333733313330363136353334333733383631363233393332333036333338363333303335333833373635333833363335333533363631363133393336333833313339333136343335333233313330363532323764326332323737363937343638363437323631373736313663353037353632346236353739323233613232363233333332333333353333333736323332333833363337363433393636333236323631363533303336333836363339333336353337333536313339363533323635333136333338363433353339333436353333333633393336363333333334363436333338333033313330363436333334333033333635363136353635363136363334333333373335333636313334333433303636363333383332363533313633333636363334333536333336363533383333333433383333333433333636323237643764222c226174744d656d6f7279223a2237623764222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a223762323236393634323233613232363633323636333633313333333336353264363433373335333432643334333333353632326433393333333836313264333433353337363636323634363636323330363333353634323232633232363936653634363537383464363137303730363537323232336137623232363136323333333233313634333633333632333736323339333933313331333033373631333533363336333736323636333436363635333833353333363133323336333636333332363236313635363133383337363433333333363133343331363333373635333333393631333533363334333136323636363433333632333533343333333436323337333636363331333233323339363433343335333236313633363233343335363236313338333633323338333436353333333233373339323233613232363136353632333736343632363233303264363336313339333032643334333833343339326433383632333133363264333233303331333933333337333836343331363336333339323237643263323237343739373036353232336132323438343432323764227d",
		})
		err := cmd.RootCmd.Execute()
		actualOutput := output.String()
		require.NoError(t, err)
		require.Equal(t, "7b226163636f756e7473223a2237623764222c226174744d656d6f7279223a2237623764222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a2237623232363936343232336132323636333236363336333133333333363532643634333733353334326433343333333536323264333933333338363132643334333533373636363236343636363233303633333536343232326332323639366536343635373834643631373037303635373232323361376237643263323237343739373036353232336132323438343432323764227d\n", actualOutput)
	})
	t.Run("No accounts to delete return the same storage with no accounts", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"delete",
			"--storage=7b226163636f756e7473223a2237623764222c226174744d656d6f7279223a2237623764222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a2237623232363936343232336132323636333236363336333133333333363532643634333733353334326433343333333536323264333933333338363132643334333533373636363236343636363233303633333536343232326332323639366536343635373834643631373037303635373232323361376237643263323237343739373036353232336132323438343432323764227d",
		})
		err := cmd.RootCmd.Execute()
		actualOutput := output.String()
		require.NoError(t, err)
		require.Equal(t, "7b226163636f756e7473223a2237623764222c226174744d656d6f7279223a2237623764222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a2237623232363936343232336132323636333236363336333133333333363532643634333733353334326433343333333536323264333933333338363132643334333533373636363236343636363233303633333536343232326332323639366536343635373834643631373037303635373232323361376237643263323237343739373036353232336132323438343432323764227d\n", actualOutput)
	})

}
