package account_test

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/bloxapp/eth2-key-manager/cli/cmd"
	"github.com/bloxapp/eth2-key-manager/cli/util/printer"
)

func TestAccountList(t *testing.T) {
	t.Run("Successfully list accounts", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"list",
			"--storage=7b226163636f756e7473223a2237623232333733393330363233383633363433363264333933313336333032643334333336343333326433393330333736313264363133333339333836353634363136323635363433323331323233613762323236323631373336353431363336333666373536653734353036313734363832323361323232663330323232633232363936343232336132323337333933303632333836333634333632643339333133363330326433343333363433333264333933303337363132643631333333393338363536343631363236353634333233313232326332323665363136643635323233613232363136333633366637353665373432643330323232633232373636313663363936343631373436393666366534623635373932323361376232323639363432323361323236353633333033363632333733313330326433353631363333333264333433373331363632643632333633313632326436333335333133323634333933333339333933363632333632323263323237303631373436383232336132323664326633313332333333383331326633333336333033303266333032663330326633303232326332323730373236393736346236353739323233613232333533323635333033363335333933373336333233353336333133383333363233373331363136313335333533393330333636353336333436313631363633313336333633343332333533313338363433343633333633333631363333363636333736313334363336313338333933303335333533363331333336353336333332323764326332323737363937343638363437323631373736313663353037353632346236353739323233613232363133303632333933333332333436343631333836313338363133363339333636333335333333393335333036353339333833343634363533323335363233323339333936333331333233333634333133373632363136323339333733323635363336313331363136333332363333363337333433393336333436333339363633383331333733303334333736323633333633303334333836353636333033373330333536343337363536333336363636313635333636343335363436313336323237643764222c226174744d656d6f7279223a2237623764222c226e6574776f726b223a223730373937323664366636653734222c2270726f706f73616c4d656d6f7279223a2237623764222c2277616c6c6574223a223762323236393634323233613232333633303339333333353634333536343264333733303631363132643334333736363633326433383633333836353264333536343337363636333334363133333634333733313331323232633232363936653634363537383464363137303730363537323232336137623232333933353330333833373331333833323339333333373636333633393338333236313635333933393636333936323330333636323634333133313336363633343336333336363334333133343335333133333330333333323635333333333631333336343331333733353634333933363336333236353634363436363331333633323331333033313636363336363336363336313332363133393636363536343631363436353634333733343632333833303334333736333335363436333636323233613232333733393330363233383633363433363264333933313336333032643334333336343333326433393330333736313264363133333339333836353634363136323635363433323331323237643263323237343739373036353232336132323438343432323764227d",
		})
		err := cmd.RootCmd.Execute()
		actualOutput := output.String()
		require.NotNil(t, actualOutput)
		require.NoError(t, err)
	})

	t.Run("Fail to JSON un-marshal", func(t *testing.T) {
		var output bytes.Buffer
		cmd.ResultPrinter = printer.New(&output)
		cmd.RootCmd.SetArgs([]string{
			"wallet",
			"account",
			"list",
			"--storage=7b226163636f756e7473223a2237623764222c226174744d656d6f7279223a2237623764222c2270726f706f",
		})
		err := cmd.RootCmd.Execute()
		require.Error(t, err)
		require.EqualError(t, err, "failed to JSON un-marshal storage: unexpected end of JSON input")
	})
}
